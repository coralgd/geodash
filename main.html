<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Main</title>
<link rel="stylesheet" href="hud.css">
</head>
<body>
<div class="hud" style="max-width:600px;margin:60px auto;text-align:center;">
  <h1>Главная страница</h1>
  <p id="userInfo"></p>
  <p id="userPlace"></p>
  <button id="check" style="margin-top:20px;">Проверить</button>
  <p id="err" style="color:red;margin-top:10px;"></p>
</div>

<script type="module">
import { auth, db } from './firebase.js';
import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-auth.js";
import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.14.0/firebase-firestore.js";

const info = document.getElementById('userInfo');
const place = document.getElementById('userPlace');
const err = document.getElementById('err');
const btn = document.getElementById('check');

onAuthStateChanged(auth, async user => {
  if(!user) location.href='index.html';
  const userSnap = await getDoc(doc(db,'users',user.uid));
  const u = userSnap.data();

  if(u.situation!=='verified') return location.href='nick.html';

  info.textContent = `Ник: ${u.nick}`;
  place.textContent = `Баллы: ${u.points}`;

  btn.onclick = () => {
    if(u.role==='moderator') location.href='moderator.html';
    else if(u.role==='elder') location.href='elder.html';
    else err.textContent = 'Ошибка: модерки нет';
  };
});
</script>
</body>
</html>
